{% extends "palm_app/base.html" %}
{% load static %}

{% block title %}ุงูููู ุงูุดุฎุตู{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/profile.css' %}">

<div class="page-bg"></div>

<div class="profile-page">

    <!-- ================= PROFILE HEADER ================= -->
    <input type="checkbox" id="editProfileToggle" hidden>
    <div class="glass-card profile-header">

        <!-- ===== Avatar Column ===== -->
        <div class="profile-avatar">

            {% if request.user.profile.avatar %}
                <img src="{{ request.user.profile.avatar.url }}" class="avatar-img">
            {% else %}
                <div class="avatar-placeholder">
                    <span class="avatar-icon">๐ค</span>
                </div>
            {% endif %}

            <!-- Upload Avatar -->
            <form
                action="{% url 'upload_avatar' %}"
                method="POST"
                enctype="multipart/form-data"
            >
                {% csrf_token %}
                <input
                    type="file"
                    id="avatarInput"
                    name="avatar"
                    accept="image/*"
                    hidden
                    onchange="this.form.submit()"
                >
                <label for="avatarInput" class="btn-primary avatar-upload-btn">
                    ุชุบููุฑ ุงูุตูุฑุฉโ๏ธ
                </label>
            </form>

        </div>

        <!-- ===== Info Columns ===== -->
        <div class="profile-info-grid">

            <!-- Column 1 -->
            <div class="profile-column">
                <div class="info-box">
                    <label>ุงูุงุณู ุงูุฃูู</label>
                    <span>{{ request.user.first_name }}</span>
                </div>

                <div class="info-box">
                    <label>ุงุณู ุงูุนุงุฆูุฉ</label>
                    <span>{{ request.user.last_name }}</span>
                </div>

                <div class="info-box">
                    <label>ูููุฉ ุงููุฑูุฑ</label>
                    <span>********</span>
                </div>
            </div>

            <!-- Column 2 -->
            <div class="profile-column">
                <div class="info-box">
                    <label>ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                    <span>{{ request.user.email }}</span>
                </div>

                <div class="info-box">
                    <label>ุฑูู ุงูุฌูุงู</label>
                    <span>{{ request.user.profile.phone|default:"โ" }}</span>
                </div>

                <div class="info-box">
                    <label>ุงููููุน</label>
                    <span>{{ request.user.profile.location|default:"โ" }}</span>
                </div>

                <!-- Toggle Modal -->
                <label for="editProfileToggle" class="edit-icon-btn btn-secondary edit-profile-btn">
                    ุชุนุฏูู ุงูุจูุงูุงุชโ๏ธ
                </label>
            </div>

        </div>
    </div>

    <!-- ===== MODAL (ูุงุฒู ูููู ุฃุฎ ููู checkbox) ===== -->
    <div class="modal-overlay edit-modal">
        <div class="modal-card glass-card">
            <h3 class="modal-title">ุชุนุฏูู ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ</h3>

            <form method="POST" action="{% url 'edit_profile' %}">
                {% csrf_token %}

                <div class="modal-grid">
                    <div>
                        <label>ุงูุงุณู ุงูุฃูู</label>
                        <input type="text" name="first_name" value="{{ request.user.first_name }}">
                    </div>
                    <div>
                        <label>ุงุณู ุงูุนุงุฆูุฉ</label>
                        <input type="text" name="last_name" value="{{ request.user.last_name }}">
                    </div>
                    <div>
                        <label>ุฑูู ุงูุฌูุงู</label>
                        <input type="text" name="phone" value="{{ request.user.profile.phone }}">
                    </div>
                    <div>
                        <label>ุงููููุน</label>
                        <input type="text" name="location" value="{{ request.user.profile.location }}">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn-green modal-close">ุญูุธ</button>
                    <label for="editProfileToggle" class="btn-green modal-close">
                        ุฅูุบุงุก
                    </label>
                </div>
            </form>
        </div>
    </div>

    <!-- ================= STATS ================= -->
    <div class="stats-grid">

        <div class="glass-card stat-card">
            <div class="stat-badge">
                <span class="stat-icon">๐</span>
                <div class="stat-text">
                    <span class="stat-number">{{ total_diagnoses }}</span>
                    <span class="stat-label">ุนุฏุฏ ุงูุชุดุฎูุตุงุช</span>
                </div>
            </div>
        </div>

        <div class="glass-card stat-card">
            <div class="stat-badge">
                <span class="stat-icon">๐ธ</span>
                <div class="stat-text">
                    <span class="stat-number">{{ total_images }}</span>
                    <span class="stat-label">ุตูุฑ ูุฑููุนุฉ</span>
                </div>
            </div>
        </div>

        <div class="glass-card stat-card">
            <div class="stat-badge">
                <span class="stat-icon">๐ด</span>
                <div class="stat-text">
                    <span class="stat-number">{{ healthy_percentage }}%</span>
                    <span class="stat-label">ูุณุจุฉ ุงูุณูููุฉ</span>
                </div>
            </div>
        </div>

        <div class="glass-card stat-card">
            <div class="stat-badge">
                <span class="stat-icon">โฑ</span>
                <div class="stat-text">
                    <span class="stat-number">
                        {% if days_since_last != None %}
                            {{ days_since_last }} ููู
                        {% else %}
                            โ
                        {% endif %}
                    </span>
                    <span class="stat-label">ุขุฎุฑ ุชุดุฎูุต</span>
                </div>
            </div>
        </div>

    </div>
</div>

{% endblock %}
